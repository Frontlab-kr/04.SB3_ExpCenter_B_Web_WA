import{_ as S}from"./M4_Select-BrpBkW3R.js";import{_ as A}from"./M4_Date-mLiFp0Aq.js";import{_ as x,a8 as Y,a9 as I,E as h,A as m,g as u,i as E,k as o,C as d,l as _,s as p,D as M,H as y,x as T,F as g,m as C}from"./index-BhJ3e6-f.js";import{V as b,a as f}from"./VRow-BWQWQq16.js";import{V as v}from"./VDataTable-DnPdquPO.js";import"./VTextField-C0rbKIZT.js";const N={data(){return{cSearchDate:Y(new Date),cSelectedExp:"",oSelectedExp:[],zExpProgramList:[],ToDaydate:new Date,zReservationDayList:[],zReservationCntInfo:[],zHolyDayList:[],zSelectReservationTimeList:[],headers:[{title:"회차",key:"iIndex",sortable:!1,align:"center"},{title:"체험시간",key:"ExpTime",sortable:!1,align:"center"},{title:"정원",key:"iMaxCnt",sortable:!1,align:"center"},{title:"예약인원",key:"iNowCnt",sortable:!1,align:"center"},{title:"빈자리수",key:"iAvailableCnt",sortable:!1,align:"center"}]}},components:{},computed:{},mounted(){this.GetProgramInfo()},beforeUnmount(){},methods:{CheckChange(){this.oSelectedExp=this.zExpProgramList.filter(a=>a.cExpCd==this.cSelectedExp)[0]},cDateTypeToString(a){return[a.getFullYear(),(a.getMonth()+1).toString().padStart(2,"0"),a.getDate().toString().padStart(2,"0")].join("-")},CheckCapacity(a,t,i,e){let l=e.filter(n=>n.RSVT_DT==this.cDateTypeToString(t)&&n.RSVT_TIME_CD==a.RSVT_TIME_CD),s=0;t.getDay()+1==7?s=a.SAT_MAX_NOPE:t.getDay()+1==1?s=a.SUN_MAX_NOPE:s=a.MAX_NOPE;let r=i.filter(n=>n.HOILDAY_YMD==this.cDateTypeToString(t));for(let n=0;n<r.length;n++){var D=new Date(r[n].HOILDAY_YMD);D.getDay()+1==a.DAY_TYPE&&(s=r[n].TIME_CD_LIST.split(",").filter(R=>R==a.RSVT_TIME_CD).length>0?a.HOLIDAY_MAX_NOPE:s)}let c=l.length>0?l[0].iTotalCnt:0;return{iMaxCnt:s,iNowCnt:c,isAvailable:s>c}},CalcMaxCnt(a,t){let i=0;a.DAY_TYPE==7?i=a.SAT_MAX_NOPE:a.DAY_TYPE==1?i=a.SUN_MAX_NOPE:i=a.MAX_NOPE,t.filter(l=>l.HOILDAY_YMD);for(let l=0;l<t.length;l++){var e=new Date(t[l].HOILDAY_YMD);e.getDay()+1==a.DAY_TYPE&&(i=t[l].TIME_CD_LIST.split(",").filter(s=>s==a.RSVT_TIME_CD).length>0?a.HOLIDAY_MAX_NOPE:i)}return i},async GetSerchReservationInfo(){this.zReservationDayList=[],this.zReservationCntInfo=[],this.zHolyDayList=[],this.zSelectReservationTimeList=[];var a=await this.GetReservationListLog();if(a.data.ResultCd=="00"){this.zReservationDayList=a.data.Result1,this.zReservationCntInfo=a.data.Result2,this.zHolyDayList=a.data.Result3,this.zReservationDayList.forEach(e=>{e.DAY_TYPE=Number(e.DAY_TYPE)});let t=new Date(this.cSearchDate),i=this.zReservationDayList.filter(e=>e.DAY_TYPE==t.getDay()+1);for(let e=0;e<i.length;e++){let{iMaxCnt:l,iNowCnt:s,isAvailable:r}=this.CheckCapacity(i[e],t,this.zHolyDayList,this.zReservationCntInfo);this.zSelectReservationTimeList.push({iIndex:e+1,ExpTime:I(Number(i[e].RSVT_TIME_CD.substring(3,5))),RSVT_TIME_CD:i[e].RSVT_TIME_CD,iMaxCnt:l,iNowCnt:s,iAvailableCnt:l-s,bAble:r})}}else h.$emit("onShowMsg",{cSubTitle:"목록 조회 중 문제가 발생했습니다.",cTitle:"문제가 계속 되면 관리자에게 문의 바랍니다.",cMsg:`(${a.data.ResultCd}) ${a.data.Msg}`})},GetReservationListLog(){var a={SITE_CD:"boramea",EXP_CD:this.oSelectedExp.cExpCd,StartDate:this.cSearchDate};return new Promise(t=>m.post("https://test1-fire.seoul.go.kr/cmsapi/GetReservationListLog",a,{headers:{}}).then(i=>{t(i)}).catch(i=>{t({data:{ResultCd:"98",Msg:i}})}))},GetProgramInfo(){var a={SITE_CD:"boramea"};m.post("https://test1-fire.seoul.go.kr/cmsapi/GetProgramInfo",a,{headers:{}}).then(t=>{if(t.data.ResultCd==="00"){var i=[];t.data.Result3.forEach(e=>{e.cPath="https://test1-fire.seoul.go.kr/cmsapi/DownloadFile?FileUrl="+e.cPath});for(let e=0;e<t.data.Result1.length;e++){let l={zImgInfo:[{cPath:"/gwangnaru/contents/main_001.jpg",ALT_TEXT:"소방복과 공기호흡기를 착용한 소방관이 무릎을 꿇고 앉아 화재 현장을 바라보고 있는 모습"}],cType:"em",cExpCd:t.data.Result1[e].EXP_CD,cFloorId:"0F",x:0,y:0,INDV_YN:t.data.Result1[e].INDV_YN,GROUP_YN:t.data.Result1[e].GROUP_YN,AGE1_YN:t.data.Result1[e].AGE1_YN,AGE2_YN:t.data.Result1[e].AGE2_YN,AGE3_YN:t.data.Result1[e].AGE3_YN,AGE4_YN:t.data.Result1[e].AGE4_YN,AGE5_YN:t.data.Result1[e].AGE5_YN,AGE6_YN:t.data.Result1[e].AGE6_YN,AGE7_YN:t.data.Result1[e].AGE7_YN,cExpNm:t.data.Result1[e].EXP_PRGRM_NM,TIME_DESC:t.data.Result1[e].TIME_DESC,cInfo:[t.data.Result1[e].PRGRM_DESC,t.data.Result1[e].AGE_DESC,t.data.Result1[e].ETC_DESC].filter(Boolean).join("<br>")},s=t.data.Result2.filter(r=>r.EXP_CD==t.data.Result1[e].EXP_CD);s.length>0&&(l.zImgInfo=t.data.Result3.filter(r=>r.EXP_CD==s[0].EXP_CD),l.cType=s[0].POI_TYPE,l.cFloorId=s[0].FLOOR,l.isText=s[0].TEXT_YN=="Y",l.x=s[0].X_DATA,l.y=s[0].Y_DATA),i.push(l)}this.zExpProgramList=i,this.zExpProgramList.length>0&&(this.oSelectedExp=this.zExpProgramList[0],this.cSelectedExp=this.oSelectedExp.cExpCd)}else h.$emit("onShowMsg",{cSubTitle:"프로그램 목록 조회 중 문제가 발생했습니다.",cTitle:"계속 지속될 경우 담당자에게 문의 바랍니다."})}).catch(t=>{h.$emit("onShowMsg",{cSubTitle:"프로그램 목록 조회 중 문제가 발생했습니다.",cTitle:"계속 지속될 경우 담당자에게 문의 바랍니다."})}).finally(()=>{})}}},L={class:"title-xxlarge"},P={class:"mt-2 pa-3"},G={class:"nor_table_center"},z=o("caption",{id:"table-caption",class:"sr-only"},"예약현황 테이블",-1);function V(a,t,i,e,l,s){const r=A,D=S;return u(),E("div",null,[o("h1",L,d(a.$t("menu_0304_예약현황조회")),1),_(b,{class:"pt-4"},{default:p(()=>[_(f,{cols:"12",sm:"6",md:"3",class:"pt-0 pb-0 pr-2 pl-2"},{default:p(()=>[_(r,{cDate:l.cSearchDate,"onUpdate:cDate":t[0]||(t[0]=c=>l.cSearchDate=c),cMessage:"",cLabel:"날짜",ref:"M4_Date_ref"},null,8,["cDate"])]),_:1}),_(f,{cols:"12",sm:"6",md:"3",class:"pt-0 pb-0 pr-2 pl-2"},{default:p(()=>[_(D,{modelValue:l.cSelectedExp,"onUpdate:modelValue":[t[1]||(t[1]=c=>l.cSelectedExp=c),t[2]||(t[2]=c=>s.CheckChange())],items:l.zExpProgramList,placeholder:"체험을 선택하세요.",density:"compact",variant:"outlined",color:"primary","persistent-placeholder":"","item-title":"cExpNm","item-value":"cExpCd",label:"체험을 선택하세요.","single-line":"","return-object":""},null,8,["modelValue","items"])]),_:1}),_(f,{cols:"12",sm:"6",md:"3",class:"pt-6 pl-2"},{default:p(()=>[_(M,{onClick:t[3]||(t[3]=c=>s.GetSerchReservationInfo()),"aria-label":"조회"},{default:p(()=>[_(y,{"aria-hidden":"true",style:{"margin-right":"6px"}},{default:p(()=>[T("mdi-magnify")]),_:1}),T("조회")]),_:1})]),_:1})]),_:1}),o("div",P,[_(v,{headers:l.headers,items:l.zSelectReservationTimeList,"item-key":"iIndex","aria-labelledby":"table-caption"},{default:p(c=>[o("table",G,[z,o("thead",null,[o("tr",null,[(u(!0),E(g,null,C(c.headers[0],n=>(u(),E("th",{key:n.value,scope:"col"},d(n.title),1))),128))])]),o("tbody",null,[(u(!0),E(g,null,C(c.items,n=>(u(),E("tr",{key:n.id},[o("td",null,d(n.iIndex),1),o("td",null,d(n.ExpTime),1),o("td",null,d(n.iMaxCnt),1),o("td",null,d(n.iNowCnt),1),o("td",null,d(n.iAvailableCnt),1)]))),128))])])]),_:1},8,["headers","items"])])])}const B=x(N,[["render",V]]);export{B as default};
