import{_ as w,a as B}from"./M4_Commu_DetailDialog-v4dLruwf.js";import{_ as y}from"./M4_Input-dbsElGIN.js";import{_ as k,c5 as A,E as h,A as D,ap as v,c6 as b,ah as U,ai as V,aj as x,ak as O,c7 as z,f as $,g as c,i as E,k as r,l as o,s as _,D as C,V as W,G as N,H as p,x as m,C as T,y as P,F as R,m as L,t as H,I as q}from"./index-Cp7OTZSl.js";import{E as G}from"./Editor-BfckuSqm.js";import{V as M,a as g}from"./VRow-BKzJpr8p.js";import{V as K}from"./VDataTable-HXuMMy2i.js";import"./EditorRead-CScsDkfm.js";import"./VTextField-DyJ9d4V2.js";const Q={data(){return{SHOW_PST_ID:"",BOARDLIST_ID:"",cNowSearchKeyWord:"",headers:[{title:this.$t("all_table_header_1"),key:"iIndex",sortable:!1,align:"center"},{title:this.$t("all_table_header_4"),key:"PST_TTL"},{title:this.$t("all_table_header_2"),key:"is_file",sortable:!1,align:"center"},{title:this.$t("all_table_header_5"),key:"CRT_USER_ID"},{title:this.$t("all_table_header_6"),key:"cShowCreateDateTime"},{title:this.$t("all_table_header_3"),key:"INQ_CNT"}],zData:[],bDialog:!1,iEditIndex:-1,NowSelFile:null,oEditItem:{PST_ID:"",CRT_USER_ID:"",MBL_TELNO:"",PST_CN:"",PST_TTL:"",FILE_ID:"NONE",FILE_NM:"",FILE_PATH:""},oDefaultEditItem:{PST_ID:"",CRT_USER_ID:"",MBL_TELNO:"",PST_CN:"",PST_TTL:"",FILE_ID:"NONE",FILE_NM:"",FILE_PATH:""},cName:"",cTelNo:"",cBirth:"",cToken:""}},computed:{sFormatTitle(){return this.iEditIndex==-1?"신규 작성":"수정"},bDisablePreBtn(){return this.iEditIndex==0},bDisableNextBtn(){return this.iEditIndex==this.zData.length-1}},components:{Editor:G},mounted(){var e=this.findMenuById(this.$store.state.main_menu,A().name);e.BOARDLIST_ID?this.BOARDLIST_ID=e.BOARDLIST_ID:this.BOARDLIST_ID="",this.SHOW_PST_ID=this.$route.query.id?this.$route.query.id:"",this.GetBoardWithAuthInfo()},beforeUnmount(){},methods:{findMenuById(e,t){for(const l of e){if(l.path===t)return l;if(l.menu_dept1){const a=this.findMenuById(l.menu_dept1,t);if(a)return a}if(l.menu_dept2){const a=this.findMenuById(l.menu_dept2,t);if(a)return a}}return null},UpdateData(e){this.oEditItem.PST_CN=e},onClear(){this.NowSelFile=null,this.oEditItem.FILE_ID="NONE",this.oEditItem.FILE_NM=""},GetFile(){if(this.NowSelFile){h.$emit("onShowMsg",{cSubTitle:"파일을 선택 할 수 없습니다.",cTitle:"파일은 최대 1개 까지만 가능합니다.",cMsg:""});return}this.$refs.fileInput.click()},onFileSelected(e){this.NowSelFile=e.target.files[0],this.oEditItem.FILE_NM=this.NowSelFile.name},ClickIconDirect(e,t){e.stopPropagation(),this.DownloadFile(t)},DownloadFile(e){D({url:"https://test1-fire.seoul.go.kr/cmsapi/DownloadFile?FileUrl="+e.FILE_PATH,method:"GET",responseType:"blob"}).then(t=>{const l=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=l,a.setAttribute("download",e.FILE_NM),document.body.appendChild(a),a.click()})},GetBoardWithAuthInfo(){this.zData=[];var e={BoardType:"REVIEW",SITE_ID:"1034",NowSearchKeyWord:this.cNowSearchKeyWord};D.post("https://test1-fire.seoul.go.kr/cmsapi/GetBoardWithAuthInfo",e,{headers:{}}).then(t=>{if(t.data.ResultCd==="00"){let l=t.data.Result.length;const a={};t.data.Result.forEach(i=>{a[i.UP_PST_ID]||(a[i.UP_PST_ID]=[]),a[i.UP_PST_ID].push(i)});const s=[];if(t.data.Result.forEach(i=>{i.PST_ID===i.UP_PST_ID&&(s.push(i),a[i.PST_ID]&&s.push(...a[i.PST_ID].filter(d=>d.PST_ID!==d.UP_PST_ID).sort(function(d,I){return d.PST_DEPTH-I.PST_DEPTH})))}),this.zData=s.map((i,d)=>(i.iIndex=l-d,i.is_file=v(i.ATCH_FILE_YN),i.cShowCreateDateTime=b(i.CRT_DT),i)),this.SHOW_PST_ID!=""){let i=this.zData.find(d=>d.PST_ID==this.SHOW_PST_ID);this.ShowDetailDialog(i)}}else h.$emit("onShowMsg",{cSubTitle:"체험후기 조회 중 문제가 발생했습니다.",cTitle:"계속 지속될 경우 담당자에게 문의 바랍니다.",cMsg:`Error : ${t.data.Msg}`})}).catch(t=>{h.$emit("onShowMsg",{cSubTitle:"체험후기 정보 조회 중 문제가 발생했습니다.",cTitle:"계속 지속될 경우 담당자에게 문의 바랍니다.",cMsg:`Error : ${t}`})}).finally(()=>{})},ShowDialog(){this.$refs.M4_Commu_AuthDialog_ref.ShowDialog("")},async ShowDetailDialog(e){var t=await this.GetBoardWithAuthItemInfo(e);t?t.data.ResultCd=="00"?(this.iEditIndex=this.zData.indexOf(e),this.zData[this.iEditIndex].INQ_CNT=t.data.Result1[0].INQ_CNT,this.$refs.M4_Commu_DetailDialog_ref.ShowDialog({PST_ID:e.PST_ID,SelectIndex:this.iEditIndex,PST_TTL:e.PST_TTL,CRT_USER_ID:e.CRT_USER_ID,INQ_CNT:t.data.Result1[0].INQ_CNT,PST_CN:t.data.Result1[0].PST_CN,Title:"체험후기"},t.data.Result2),this.$store.state.btnDialogRef=document.activeElement):h.$emit("onShowMsg",{cSubTitle:"상세보기 창을 여는 중 문제가 발생했습니다.",cTitle:"게시글이 삭제되었을 수 있습니다. 화면을 새로고침 하여 주세요.",cMsg:""}):h.$emit("onShowMsg",{cSubTitle:"상세보기 창을 여는 중 문제가 발생했습니다.",cTitle:"게시글이 삭제되었을 수 있습니다. 화면을 새로고침 하여 주세요.",cMsg:`Error : ${t.data.Msg}`})},handleRowClick(e,{item:t}){this.ShowDetailDialog(t)},GetBoardWithAuthItemInfo(e){var t={BoardType:"REVIEW",SITE_ID:"1034",BOARDLIST_ID:this.BOARDLIST_ID,PST_ID:e.PST_ID};return new Promise(l=>D.post("https://test1-fire.seoul.go.kr/cmsapi/GetBoardWithAuthItemInfo",t,{headers:{}}).then(a=>{l(a)}).catch(a=>{l({data:{ResultCd:"98",Msg:a}})}))},DialogClose(){this.bDialog=!1,this.$store.state.isDialog=!1,h.$emit("onBackDialogBtn")},EndAuth(e,t){e==""&&(this.$refs.M4_Commu_AuthDialog_ref.CloseDialog(),this.oEditItem.CRT_USER_ID=t.cRequestName,this.oEditItem.MBL_TELNO=t.cRequestMobile,this.oDefaultEditItem.CRT_USER_ID=t.cRequestName,this.oDefaultEditItem.MBL_TELNO=t.cRequestMobile,this.cName=t.cRequestName,this.cTelNo=t.cRequestMobile,this.cBirth=t.cRequestBirth,this.cToken=t.jwt,this.bAgreeDialog=!1,this.bDialog=!0,this.$store.state.isDialog=!0,this.$store.state.btnDialogRef=document.activeElement)},bSendSvrFile(e){var t=new Date,l=t.getFullYear(),a=e.name,s=U(a).toUpperCase(),i=V(x(e.type));let d=new FormData;return d.append("uploadfilenor",e),new Promise(I=>D.post("https://test1-fire.seoul.go.kr/cmsapi/UploadFileNorNew?PublicFile=Y&Year="+l+"&FileNm="+a+"&Extend="+s+"&MimeType="+e.type+"&Size="+e.size+"&FileTypeId="+i,d,{headers:{"Content-Type":"multipart/form-data"}}).then(S=>{I(S)}).catch(S=>{I(null),h.$emit("onShowMsg",{cSubTitle:"파일저장에 실패하였습니다.",cTitle:"관리자에게 문의 바랍니다.",cMsg:`Error : ${S}`})}))},async SetBoardWithAuthInfo(){this.oEditItem.PST_CN=this.$refs.FroalaEditor.editor.html.get();var e=!1,t="";if(this.oEditItem.PST_TTL=this.oEditItem.PST_TTL.trim(),this.oEditItem.PST_CN=this.oEditItem.PST_CN.trim(),this.oEditItem.PST_CN=this.oEditItem.PST_CN.replaceAll("&nbsp;","&nbsp"),this.oEditItem.PST_TTL==""&&(t="제목이 누락되었습니다.",e=!0),!e&&this.oEditItem.PST_CN==""&&(t="내용이 누락되었습니다.",e=!0),e){h.$emit("onShowMsg",{cSubTitle:"누락된 정보가 있습니다.",cTitle:t,cMsg:""});return}if(this.NowSelFile&&this.oEditItem.FILE_ID=="NONE"){var l=await this.bSendSvrFile(this.NowSelFile);if(l.data.ResultCd=="00")this.oEditItem.FILE_ID=l.data.FileId,this.oEditItem.FILE_NM=l.data.FileNm,this.oEditItem.FILE_PATH=l.data.Path;else{h.$emit("onShowMsg",{cSubTitle:"파일 저장에 실패하였습니다.",cTitle:"계속 지속될 경우 담당자에게 문의 바랍니다.",cMsg:`Error : ${l.data.Msg}`});return}}var a={SITE_ID:"1034",BOARDLIST_ID:this.BOARDLIST_ID,PST_ID:this.oEditItem.PST_ID,CRT_USER_ID:this.oEditItem.CRT_USER_ID,PST_TTL:this.oEditItem.PST_TTL,PST_CN:this.oEditItem.PST_CN,MBL_TELNO:this.oEditItem.MBL_TELNO,ATCH_FILE_YN:O(this.oEditItem.FILE_ID!="NONE"),FILE_ID:this.oEditItem.FILE_ID,FILE_PATH:this.oEditItem.FILE_PATH,BoardType:"REVIEW",SITE_ID:"1034",Name:this.cName,TelNo:this.cTelNo,Birth:this.cBirth,Token:this.cToken};D.post("https://test1-fire.seoul.go.kr/cmsapi/SetBoardWithAuthInfo",a,{headers:{}}).then(s=>{if(s.data.ResultCd==="00"){if(a.PST_ID==""){this.zData.unshift({PST_ID:s.data.Result[0].PST_ID,UP_PST_ID:s.data.Result[0].PST_ID,CRT_DT:s.data.Result[0].CRT_DT,cShowCreateDateTime:b(s.data.Result[0].CRT_DT),CRT_USER_ID:z(a.CRT_USER_ID),PST_TTL:a.PST_TTL,is_file:a.FILE_ID!="NONE",INQ_CNT:0,PST_DEPTH:0,FILE_ID:this.oEditItem.FILE_ID,FILE_NM:this.oEditItem.FILE_NM,FILE_PATH:this.oEditItem.FILE_PATH});let i=this.zData.length;this.zData.forEach((d,I)=>{d.iIndex=i-I})}else this.zData[this.iEditIndex].PST_TTL=a.PST_TTL,this.zData[this.iEditIndex].FILE_ID=a.FILE_ID,this.zData[this.iEditIndex].is_file=a.FILE_ID!="NONE",this.zData[this.iEditIndex].FILE_NM=this.oEditItem.FILE_NM,this.zData[this.iEditIndex].FILE_PATH=this.oEditItem.FILE_PATH;this.DialogClose(),this.oEditItem={...this.oDefaultEditItem},this.onClear()}else h.$emit("onShowMsg",{cSubTitle:"묻고 답하기 게시글 작성 중 문제가 발생했습니다.",cTitle:"계속 지속될 경우 담당자에게 문의 바랍니다.",cMsg:`Error : ${s.data.Msg}`})}).catch(s=>{h.$emit("onShowMsg",{cSubTitle:"묻고 답하기 게시글 작성 중 문제가 발생했습니다.",cTitle:"계속 지속될 경우 담당자에게 문의 바랍니다.",cMsg:`Error : ${s}`})}).finally(()=>{})},ChangeBoardDetail(e){this.ShowDetailDialog(this.zData[e])},async EditAfterAuth(e,t){this.cName=t.cRequestName,this.cTelNo=t.cRequestMobile,this.cBirth=t.cRequestBirth,this.cToken=t.jwt;var l=await this.GetBoardWithAuthItemInfo(this.zData[e]);l?l.data.ResultCd=="00"?(this.$refs.M4_Commu_DetailDialog_ref.CloseDialog(),this.bDialog=!0,this.$store.state.isDialog=!0,this.$store.state.btnDialogRef=document.activeElement,this.oEditItem.PST_ID=this.zData[e].PST_ID,this.oEditItem.PST_TTL=this.zData[e].PST_TTL,this.oEditItem.PST_CN=l.data.Result1[0].PST_CN,this.oEditItem.CRT_USER_ID=t.cRequestName,this.oEditItem.MBL_TELNO=t.cRequestMobile,l.data.Result2.length>0&&(this.oEditItem.FILE_NM=l.data.Result2[0].FILE_NM,this.oEditItem.FILE_PATH=l.data.Result2[0].FILE_PATH,this.oEditItem.FILE_ID=l.data.Result2[0].FILE_ID),setTimeout(()=>{this.$refs.FroalaEditor.refresh(this.oEditItem.PST_CN)},300)):h.$emit("onShowMsg",{cSubTitle:"상세보기 창을 여는 중 문제가 발생했습니다.",cTitle:"게시글이 삭제되었을 수 있습니다. 화면을 새로고침 하여 주세요.",cMsg:""}):h.$emit("onShowMsg",{cSubTitle:"상세보기 창을 여는 중 문제가 발생했습니다.",cTitle:"게시글이 삭제되었을 수 있습니다. 화면을 새로고침 하여 주세요.",cMsg:`Error : ${l.data.Msg}`})},DeleteAfterAuth(e,t){var l={BoardType:"REVIEW",SITE_ID:"1034",BOARDLIST_ID:this.BOARDLIST_ID,PST_ID:this.zData[e].PST_ID,PST_TTL:this.zData[e].PST_TTL,Name:t.cRequestName,TelNo:t.cRequestMobile,Birth:t.cRequestBirth,Token:t.jwt};D.post("https://test1-fire.seoul.go.kr/cmsapi/DelBoardWithAuthInfo",l,{headers:{}}).then(a=>{if(a.data.ResultCd==="00"){this.$refs.M4_Commu_DetailDialog_ref.CloseDialog(),this.zData.splice(e,1);let s=this.zData.length;this.zData.forEach((i,d)=>{i.iIndex=s-d})}else h.$emit("onShowMsg",{cSubTitle:"게시글 삭제 중 문제가 발생했습니다.",cTitle:"계속 지속될 경우 담당자에게 문의 바랍니다.",cMsg:`Error : ${a.data.Msg}`})}).catch(a=>{h.$emit("onShowMsg",{cSubTitle:"게시글 삭제 중 문제가 발생했습니다.",cTitle:"계속 지속될 경우 담당자에게 문의 바랍니다.",cMsg:`Error : ${a}`})}).finally(()=>{})}}},Y={class:"d-flex title-xxlarge"},j=r("h1",{class:"title-xxlarge",style:{position:"relative","z-index":"10","background-color":"white"}},"체험후기",-1),J={class:"mt-2 pa-3"},X={class:"nor_table_center"},Z=r("caption",{id:"table-caption",class:"sr-only"},"체험후기 테이블",-1),tt=["onClick"],et=["onKeydown"],it=["onClick","onKeyup"],at={class:"d-flex"},lt={class:"title-xxlarge"},st={style:{"max-height":"80vh",overflow:"auto"}},ot={class:"d-flex flex-wrap mt-4"},dt=r("label",{for:"fileUpload",class:"custom-file-label",style:{display:"none"}},"파일 첨부",-1);function rt(e,t,l,a,s,i){const d=y,I=$("Editor"),S=w,F=B;return c(),E("div",null,[r("div",Y,[j,o(N),o(C,{onClick:t[0]||(t[0]=n=>i.ShowDialog())},{default:_(()=>[o(p,{"aria-hidden":"true",style:{"margin-right":"6px"}},{default:_(()=>[m("mdi-pencil")]),_:1}),m(T(e.$t("all_btn_write")),1)]),_:1})]),r("div",J,[o(M,null,{default:_(()=>[o(g,null,{default:_(()=>[o(d,{modelValue:s.cNowSearchKeyWord,"onUpdate:modelValue":t[1]||(t[1]=n=>s.cNowSearchKeyWord=n),onKeyup:P(i.GetBoardWithAuthInfo,["enter"]),"onClick:appendInner":i.GetBoardWithAuthInfo,label:e.$t("common_search"),placeholder:e.$t("all_table_placeholder_1"),density:"compact",variant:"outlined",color:"primary","persistent-placeholder":"",iconTitle:"검색",icon:"mdi-magnify"},null,8,["modelValue","onKeyup","onClick:appendInner","label","placeholder"])]),_:1})]),_:1}),o(K,{headers:s.headers,items:s.zData,"onClick:row":i.handleRowClick,"item-key":"PST_ID","aria-labelledby":"table-caption"},{default:_(n=>[r("table",X,[Z,r("thead",null,[r("tr",null,[(c(!0),E(R,null,L(n.headers[0],u=>(c(),E("th",{key:u.value,scope:"col"},T(u.title),1))),128))])]),r("tbody",null,[(c(!0),E(R,null,L(n.items,u=>(c(),E("tr",{key:u.id,onClick:f=>i.handleRowClick(null,{item:u})},[r("td",null,T(u.iIndex),1),r("td",{tabindex:"0",onKeydown:P(f=>i.handleRowClick(null,{item:u}),["enter"]),style:{cursor:"pointer"}},T(u.PST_TTL),41,et),r("td",null,[u.is_file?(c(),E("div",{key:0,style:{cursor:"pointer"},onClick:f=>i.ClickIconDirect(f,u),onKeyup:P(f=>i.ClickIconDirect(f,u),["enter"])},[o(p,{"aria-hidden":"true"},{default:_(()=>[m("mdi-file")]),_:1})],40,it)):H("",!0)]),r("td",null,T(u.CRT_USER_ID),1),r("td",null,T(u.cShowCreateDateTime),1),r("td",null,T(u.INQ_CNT),1)],8,tt))),128))])])]),_:1},8,["headers","items","onClick:row"])]),o(W,{"aria-modal":"true","onUpdate:modelValue":[i.DialogClose,t[9]||(t[9]=n=>s.bDialog=n)],modelValue:s.bDialog,width:"80%"},{default:_(()=>[o(q,{class:"pa-4 pl-6 pr-6"},{default:_(()=>[r("div",at,[r("h1",lt,T(i.sFormatTitle),1),o(N),o(C,{variant:"plain",class:"mt-n1 mr-n3",icon:"",onClick:i.DialogClose,title:"닫기"},{default:_(()=>[o(p,{"aria-hidden":"true"},{default:_(()=>[m("mdi-close")]),_:1})]),_:1},8,["onClick"])]),r("div",st,[o(M,{class:"ma-0"},{default:_(()=>[o(g,{cols:"12",md:"4",sm:"12"},{default:_(()=>[o(d,{modelValue:s.oEditItem.CRT_USER_ID,"onUpdate:modelValue":t[2]||(t[2]=n=>s.oEditItem.CRT_USER_ID=n),readonly:"",label:e.$t("all_table_header_5")},null,8,["modelValue","label"])]),_:1}),o(g,{cols:"12"},{default:_(()=>[o(d,{modelValue:s.oEditItem.PST_TTL,"onUpdate:modelValue":t[3]||(t[3]=n=>s.oEditItem.PST_TTL=n),label:e.$t("all_table_header_4")+"(*)"},null,8,["modelValue","label"])]),_:1}),o(g,{cols:"12"},{default:_(()=>[o(I,{modelValue:s.oEditItem.PST_CN,"onUpdate:modelValue":t[4]||(t[4]=n=>s.oEditItem.PST_CN=n),onUpdateData:i.UpdateData,ref:"FroalaEditor","aria-label":"내용입력"},null,8,["modelValue","onUpdateData"])]),_:1}),o(g,{cols:"12",md:"12",sm:"12"},{default:_(()=>[o(d,{modelValue:s.oEditItem.FILE_NM,"onUpdate:modelValue":t[5]||(t[5]=n=>s.oEditItem.FILE_NM=n),"hide-details":"",label:e.$t("all_dialog_item_1"),"onClick:clear":i.onClear,clearable:"",readonly:""},null,8,["modelValue","label","onClick:clear"])]),_:1})]),_:1})]),r("div",ot,[dt,r("input",{id:"fileUpload","aria-hidden":"true",type:"file",ref:"fileInput",style:{display:"none"},multiple:"",onChange:t[6]||(t[6]=(...n)=>i.onFileSelected&&i.onFileSelected(...n))},null,544),o(C,{onClick:t[7]||(t[7]=n=>i.GetFile()),class:"mr-2 mb-1",style:{"min-width":"100px"}},{default:_(()=>[m(T(e.$t("all_btn_add_file")),1),o(p,{"aria-hidden":"true",class:"ml-1"},{default:_(()=>[m("mdi-paperclip")]),_:1})]),_:1}),o(N),o(C,{onClick:t[8]||(t[8]=n=>i.SetBoardWithAuthInfo()),class:"mb-1",color:"primary",width:"100"},{default:_(()=>[m(T(e.$t("all_btn_save")),1),o(p,{"aria-hidden":"true",class:"ml-1"},{default:_(()=>[m("mdi-upload")]),_:1})]),_:1})])]),_:1})]),_:1},8,["onUpdate:modelValue","modelValue"]),o(S,{onEndAuth:i.EndAuth,ref:"M4_Commu_AuthDialog_ref"},null,8,["onEndAuth"]),o(F,{bDisablePreBtn:i.bDisablePreBtn,bDisableNextBtn:i.bDisableNextBtn,bShowEditBtn:!0,bShowDelBtn:!0,onChangeBoardDetail:i.ChangeBoardDetail,onEditAfterAuth:i.EditAfterAuth,onDeleteAfterAuth:i.DeleteAfterAuth,ref:"M4_Commu_DetailDialog_ref"},null,8,["bDisablePreBtn","bDisableNextBtn","onChangeBoardDetail","onEditAfterAuth","onDeleteAfterAuth"])])}const ct=k(Q,[["render",rt]]);export{ct as default};
